<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Did We Start A War Today?</title>
  <meta name="description" content="A daily answer to one question: did the United States start or significantly escalate a war today?" />

  <!-- Open Graph -->
  <meta property="og:title" content="Did We Start A War Today?" />
  <meta property="og:description" content="A daily answer to one very specific question." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://didwestartawartoday.com" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Did We Start A War Today?" />
  <meta name="twitter:description" content="A daily answer to one very specific question." />

  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üåê</text></svg>" />
</head>
<body class="loading">

  <div class="site-wrapper">
    <p class="site-title">didwestartawartoday.com</p>

    <h1 class="status-answer" id="status-answer">‚Äî</h1>
    <p class="status-tagline" id="status-tagline">Loading today's assessment...</p>

    <hr class="divider" />

    <div class="headlines" id="headlines" aria-label="Source headlines"></div>
  </div>

  <footer>
    <span class="footer-updated" id="footer-updated">Updated daily.</span>
    <a href="about.html">About &amp; Methodology</a>
  </footer>

  <script>
    const STATUS_MAP = {
      no:      { label: 'No.',      bodyClass: 'status-no' },
      unclear: { label: 'Maybe?',   bodyClass: 'status-unclear' },
      yes:     { label: 'Yes.',     bodyClass: 'status-yes' },
    };

    function formatDate(isoString) {
      const d = new Date(isoString);
      const opts = { month: 'long', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit', timeZone: 'UTC', timeZoneName: 'short' };
      return d.toLocaleString('en-US', opts);
    }

    async function loadStatus() {
      let data;
      try {
        const res = await fetch('status.json?v=' + Date.now());
        if (!res.ok) throw new Error('fetch failed');
        data = await res.json();
      } catch (err) {
        console.error('Could not load status.json', err);
        document.getElementById('status-answer').textContent = '?';
        document.getElementById('status-tagline').textContent = 'Could not load today\'s status. Try refreshing.';
        return;
      }

      const { status, tagline, updated, headlines } = data;
      const mapping = STATUS_MAP[status] || STATUS_MAP['unclear'];

      // Apply status class to body
      document.body.classList.remove('loading');
      document.body.classList.add(mapping.bodyClass);

      // Set answer
      document.getElementById('status-answer').textContent = mapping.label;

      // Set tagline
      document.getElementById('status-tagline').textContent = tagline;

      // Set headlines
      const headlinesEl = document.getElementById('headlines');
      headlinesEl.innerHTML = '';
      if (headlines && headlines.length) {
        headlines.forEach(h => {
          const item = document.createElement('div');
          item.className = 'headline-item';
          item.innerHTML = `
            <a href="${escapeHtml(h.url)}" target="_blank" rel="noopener noreferrer">
              <span class="headline-source">${escapeHtml(h.source)}</span>
              <span class="headline-title">${escapeHtml(h.title)}</span>
            </a>`;
          headlinesEl.appendChild(item);
        });
      }

      // Update footer
      if (updated) {
        document.getElementById('footer-updated').textContent =
          'Last checked: ' + formatDate(updated);
      }

      // Update page title with result
      document.title = mapping.label + ' ‚Äî Did We Start A War Today?';
    }

    function escapeHtml(str) {
      if (!str) return '';
      return str
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    loadStatus();
  </script>
</body>
</html>
